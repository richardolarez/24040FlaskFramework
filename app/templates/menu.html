<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Main Menu</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='index.css') }}">
  <style>
    .hidden {
      display: none;
    }
    .white-bg {
      background-color: white;
    }
  </style>
</head>

<body>
  <!--<h1>Home / Electrical Diagram View</h1> -->
  <h2 class="banner">
    <img src=static/images/Engineering.png alt="Engineering">
    <img src=static/images/NGC.png alt="NGC logo">
  </h2>
  <div>
    <img src=static/images/Janusimage.png alt="Janus Logo" class="logo">
  </div>

  <h3 class="name">J.A.N.U.S.</h3>
  <h3 class="name2">Electrical & Technical Diagram Assistant</h3>
  <h3 class="name2">Main Menu</h3>

  <div class="center-form">
    <a href="/edv"><button class="button">EDV</button></a><br><br>
  </div>

  <div class="center-form">
    <button class="button" onclick="toggleTable('table1')">Create New Project</button>

    <table id="table1" class="hidden" style="color:white">
      <tr>
        <th>Please Upload the Electrical Diagram Zip File</th>
      </tr>
      <tr>
        <td class="button">
          <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file" accept=".zip" required>
            <button type="submit">Upload</button>
          </form>
        </td>
      </tr>
    </table>
    <br><br>

    <button class="button" onclick="fetchData()">Select Existing Project</button>

    <div
      x-data="{ 
        tableItems: [],
        loading: true
      }"
      x-init="fetchData()"
      class="max-w-screen-xl mx-auto px-4 md:px-8"
    >
      <div id="tableContainer" class="hidden white-bg"></div>
    </div>

    <br><br>
    <div class="center-form">
      <a href="/"><button class="button">Logout</button></a><br><br>
    </div>
    <script>
      function toggleTable(tableId) {
        var table = document.getElementById(tableId);
        if (table.classList.contains('hidden')) {
          table.classList.remove('hidden');
        } else {
          table.classList.add('hidden');
        }
      }

      function fetchData() {
        fetch('/projects')
          .then(response => response.json())
          .then(data => {
            if (Array.isArray(data)) {
              window.tableItems = data;
              showTable(); // Call showTable after fetching data
            } else {
              console.error('Invalid data format received from API');
            }
            window.loading = false;
          })
          .catch(error => {
            console.error('Error fetching data:', error);
            window.loading = false;
          });
      }

      function generateTable(data) {
        let table = '<table class="w-full table-auto text-sm text-left white-bg">';
        // Generate table header
        table += '<thead class="bg-gray-50 text-gray-600 font-medium border-b">';
        table += '<tr>';
        for (const key in data[0]) {
          table += `<th class="py-3 px-6">${key}</th>`;
        }
        table += '</tr>';
        table += '</thead>';
        // Generate table body
        table += '<tbody class="text-gray-600 divide-y">';
        data.forEach(item => {
          table += `<tr onclick="selectProject('${item.id}')" style="cursor: pointer;">`; // Added style to change cursor to pointer
          for (const key in item) {
        table += `<td class="px-6 py-4 whitespace-nowrap">${item[key]}</td>`;
          }
          table += '</tr>';
        });
        table += '</tbody>';
        table += '</table>';
        return table;
      }

      function showTable() {
        const tableContainer = document.getElementById('tableContainer');
        tableContainer.innerHTML = generateTable(window.tableItems);
        tableContainer.classList.remove('hidden');
      }

      function selectProject(projectId) {
        sessionStorage.setItem('selectedProject', projectId);
        // Redirect to another page or perform other actions as needed
        window.location.href = '/edv';
      }
    </script>
  </body>
</html>
