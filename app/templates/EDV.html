<!-- FILEPATH: /Users/richardolarez/SeniorCapstone/24040FlaskFramework/templates/EDV.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Project View</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='index.css') }}">
    <script src="https://unpkg.com/htmx.org@latest"></script>

    <style>
        #myTable{
            width: 90%;
        }
        .container {
            display: flex;
            height: 90vh; /* Full height of the viewport */      
        }
        .left, .right {
            flex: 1; /* Each section takes up equal space */
            flex-direction: column;
            padding: 20px; /* Optional: Adds some padding inside sections */
            align-items: center;
            text-align: center;
            justify-content: flex-start;
        }   
        .componentDropdown {
            width: 90%; /* Adjust this value to fill more of the container */
            max-width: 400px; /* Optional: Set a max width for larger screens */
            margin: 10px auto; /* Center the dropdowns horizontally within their container */
        }
        .footer{
            align-content: center;
        }
    </style>
</head>

   
<body>
  <!-- Banner -->
    <div class="banner">
        <img src=static/images/Engineering.png alt="Engineering">
        <img src=static/images/NGC.png alt="NGC logo">
    </div>
      <!-- Side bar -->
      <div class="sidebar">
        <ul >
          <li><a href="/home">Home</a></li>
          <li><a href="/menu">Main Menu</a></li>
          <li><a href="/export_project/1">Export</a></li>
          <li><a href="/">Logout</a></li>
        </ul>
      </div>

    <!-- Logo Background -->
    <div class="logo" style="background-image: url(static/images/Janusimage.png);">
      <!-- Display Project Name Based on session storage variable -->
      <h3 class="name2">Project Name: <span id="projectName"></span></h3>
      
      <!-- Start of main body -->
      <div id="tables-container"></div>
      <div id="batteryAdressesTable">
        <button onclick="addBatteryAddressRow()">Add Row</button>
        <table id="batteryTable" class="table">
            <!-- Table content generated dynamically -->
        </table>
        <button onclick="saveBatteryAddresses()">Save Changes</button>
      </div>
      <div id="tableContainer"></div>
    </div>

  </div>
  </body>

    <script>
        function showBatteryAdresses() {
            var projectId = sessionStorage.getItem("projectId");
            fetch('/battery_addresses/' + projectId)
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data)) {
                        window.batteryAdresses = data;
                        showBatteryAdressesTable();
                    } else {
                        console.error('Invalid data format received from API');
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        function showComponents() {
            var projectId = sessionStorage.getItem("projectId");
            fetch('/components/' + projectId)
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data)) {
                        window.tableItems = data;
                        showTable();
                    } else {
                        console.error('Invalid data format received from API');
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }


        function generateBatteryAdresses(data) {
            let table = '<table class="table">';
            // Table caption (title)
            table += '<caption class="name2">Battery Addresses</caption>';
            // Generate table header
            table += '<thead class="table-header">';
            table += '<tr>';
            table += '<th class="table-titles">ID</th>';
            table += '<th class="table-titles">Battery</th>';
            table += '<th class="table-titles">RS485 Address</th>';
            table += '</tr>';
            table += '</thead>';
            // Generate table body
            table += '<tbody class="table-body">';
            if (data.length > 0) {
                data.forEach(item => {
                    table += `<tr onclick="selectProject('${item.id}')" style="cursor: pointer;">`; // Added style to change cursor to pointer
                    table += `<td class="table-cell">${item.id}</td>`;
                    table += `<td class="table-cell">${item.battery}</td>`;
                    table += `<td class="table-cell">${item.rs485_address}</td>`;
                    table += '</tr>';
                });
            } else {
                table += '<tr><td colspan="3">No data available</td></tr>';
            }
            table += '</tbody>';
            table += '</table>';
            return table;
        }

        function generateComponentTable(data) {
          let table = '<table class="table">';
          // Table caption (title)
          table += '<caption class="name2">Project Identified Components</caption>';
          // Generate table header
          table += '<thead class="table-header">';
          table += '<tr>';
          table += '<th class="table-titles">ID</th>';
          table += '<th class="table-titles">Component</th>';
          table += '<th class="table-titles">Type</th>';
          table += '<th class="table-titles">Description</th>';
          table += '</tr>';
          table += '</thead>';
          // Generate table body
          table += '<tbody class="table-body">';
          if (data.length > 0) {
              data.forEach(item => {
                  table += `<tr onclick="selectProject('${item.id}')" style="cursor: pointer;">`; // Added style to change cursor to pointer
                  table += `<td class="table-cell">${item.id}</td>`;
                  table += `<td class="table-cell">${item.component}</td>`;
                  table += `<td class="table-cell">${item.type}</td>`;
                  table += `<td class="table-cell">${item.description}</td>`;
                  table += '</tr>';
              });
          } else {
              table += '<tr><td colspan="4">No data available</td></tr>';
          }
          table += '</tbody>';
          table += '</table>';
          return table;
        }
      
      function showBatteryAdressesTable() {
          const tableContainer = document.getElementById('batteryAdressesTable');
          tableContainer.innerHTML = generateBatteryAdresses(window.batteryAdresses);
          tableContainer.classList.remove('hidden');
      }

      function showTable() {
            const tableContainer = document.getElementById('tableContainer');
            tableContainer.innerHTML = generateComponentTable(window.tableItems);
            tableContainer.classList.remove('hidden');
      }

      // Register event listeners without invoking the functions
      window.addEventListener('DOMContentLoaded', showBatteryAdresses);
      window.addEventListener('DOMContentLoaded', showComponents);

      // Retrieve the project name from session storage
      var projectName = sessionStorage.getItem("projectName");

      // Update the HTML with the project name
      document.getElementById("projectName").innerText = projectName;

      // Retrieve the project id from session storage
      var projectId = sessionStorage.getItem("projectId"); 
    </script>
</html>